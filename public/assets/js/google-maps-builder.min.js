(function($){"use strict";var map;var places_service;var place;var location_marker_array=[];var search_markers=[];$(function(){var google_maps=$(".google-maps-builder");google_maps.each(function(index,value){initialize_map($(google_maps[index]))})});function initialize_map(map_canvas){var info_window=new google.maps.InfoWindow({maxWidth:315});var map_id=$(map_canvas).data("map-id");var map_data=gmb_data[map_id];var latitude=map_data.map_params.latitude?map_data.map_params.latitude:"32.713240";var longitude=map_data.map_params.longitude?map_data.map_params.longitude:"-117.159443";var map_options={center:new google.maps.LatLng(latitude,longitude),zoom:parseInt(map_data.map_params.zoom),styles:[{stylers:[{visibility:"simplified"}]},{elementType:"labels",stylers:[{visibility:"off"}]}]};map=new google.maps.Map(map_canvas[0],map_options);places_service=new google.maps.places.PlacesService(map);set_map_options(map,map_data);set_map_theme(map,map_data);set_map_markers(map,map_data,info_window);if(map_data.places_api.show_places==="yes"){perform_places_search(map,map_data,info_window)}}function set_map_theme(map,map_data){var map_type=map_data.map_theme.map_type.toUpperCase();var map_theme=map_data.map_theme.map_theme_json;if(map_type==="ROADMAP"&&map_theme!=="none"){map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP,styles:eval(map_theme)})}else{map.setOptions({mapTypeId:google.maps.MapTypeId[map_type],styles:false})}}function set_map_options(map,map_data){var zoom_control=map_data.map_controls.zoom_control;if(zoom_control==="none"){map.setOptions({zoomControl:false})}else{map.setOptions({zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle[zoom_control]}})}var mouse_zoom=map_data.map_controls.wheel_zoom;if(mouse_zoom==="none"){map.setOptions({scrollwheel:false})}else{map.setOptions({scrollwheel:true})}var pan=map_data.map_controls.pan_control;if(pan==="none"){map.setOptions({panControl:false})}else{map.setOptions({panControl:true})}var street_view=map_data.map_controls.street_view.toUpperCase();if(street_view==="NONE"){map.setOptions({streetViewControl:false})}else{map.setOptions({streetViewControl:true})}var double_click_zoom=map_data.map_controls.double_click_zoom;if(double_click_zoom==="none"){map.setOptions({disableDoubleClickZoom:true})}else{map.setOptions({disableDoubleClickZoom:false})}var draggable=map_data.map_controls.draggable;if(draggable==="none"){map.setOptions({draggable:false})}else{map.setOptions({draggable:true})}}function set_map_markers(map,map_data,info_window){var map_markers=map_data.map_markers;$(map_markers).each(function(index,marker_data){var marker_icon=map_data.map_markers_icon;if(marker_icon==="none"){var marker_icon=map_data.map_params.default_marker;if(typeof marker_data.marker!=="undefined"&&marker_data.marker.length>0){marker_icon=eval("("+marker_data.marker+")")}}var marker_label="";if(typeof marker_data.label!=="undefined"&&marker_data.label.length>0){marker_label=marker_data.label}var location_marker=new Marker({map:map,zIndex:9,icon:marker_icon,label:marker_label});var marker_lat=marker_data.lat;var marker_lng=marker_data.lng;location_marker.setPosition(new google.maps.LatLng(marker_lat,marker_lng));location_marker.setVisible(true);google.maps.event.addListener(location_marker,"click",function(){info_window.close();info_window.setContent('<div id="infobubble-content" class="loading"></div>');set_info_window_content(marker_data,info_window);info_window.open(map,location_marker)})})}function set_info_window_content(marker_data,info_window){var info_window_content;if(marker_data.title){info_window_content='<p class="place-title">'+marker_data.title+"</p>"}if(marker_data.description){info_window_content+='<div class="place-description">'+marker_data.description+"</div>"}if(marker_data.reference){var request={reference:marker_data.reference};places_service.getDetails(request,function(place,status){if(status==google.maps.places.PlacesServiceStatus.OK){info_window_content+=set_place_content_in_info_window(place);info_window_content=set_info_window_wrapper(info_window_content);info_window.setContent(info_window_content)}})}else{info_window_content=set_info_window_wrapper(info_window_content);info_window.setContent(info_window_content)}}function set_place_content_in_info_window(place){var info_window_content;info_window_content='<div class="marker-info-wrapper">';info_window_content+=place.formatted_address?'<div class="place-address">'+place.formatted_address+"</div>":"";info_window_content+=place.formatted_phone_number?'<div class="place-phone">'+place.formatted_phone_number+"</div>":"";info_window_content+=place.website?'<div class="place-website"><a href="'+place.website+'" target="_blank" rel="nofollow" title="Click to visit the '+place.name+' website">Website</a></div>':"";if(place.rating){info_window_content+='<div class="rating-wrap clear">'+'<p class="numeric-rating">'+place.rating+"</p>"+'<div class="star-rating-wrap">'+'<div class="star-rating-size" style="width:'+65*place.rating/5+'px;"></div>'+"</div>"+"</div>"}info_window_content+="</div>";return info_window_content}function set_info_window_wrapper(content){var info_window_content='<div id="infobubble-content" class="main-place-infobubble-content">';info_window_content+=content;info_window_content+="</div>";return info_window_content}function perform_places_search(map,map_data,info_window){var map_center=map.getCenter();var types_array=map_data.places_api.search_places;for(var i=0;i<search_markers.length;i++){search_markers[i].setMap(null)}search_markers=[];if(types_array.length>0){var request={location:new google.maps.LatLng(map_center.lat(),map_center.lng()),types:types_array,radius:map_data.places_api.search_radius};places_service.nearbySearch(request,function(results,status,pagination){var i=0;var result;if(status==google.maps.places.PlacesServiceStatus.OK){for(i=0;result=results[i];i++){create_search_result_marker(map,results[i],info_window)}if(pagination.hasNextPage){pagination.nextPage()}}})}}function create_search_result_marker(map,place,info_window){var search_marker=new google.maps.Marker({map:map});search_marker.setIcon({url:place.icon,size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(24,24)});search_marker.setPosition(place.geometry.location);search_marker.setVisible(true);google.maps.event.addListener(search_marker,"click",function(){info_window.close();info_window.setContent('<div id="infobubble-content" class="loading"></div>');var marker_data={title:place.name,reference:place.reference};set_info_window_content(marker_data,info_window);info_window.open(map,search_marker)});search_markers.push(search_marker)}})(jQuery);